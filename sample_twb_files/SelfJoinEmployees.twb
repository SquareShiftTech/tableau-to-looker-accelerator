<?xml version='1.0' encoding='utf-8' ?>
<workbook original-version='18.1' source-build='2025.2.0' source-platform='win' version='18.1'>
  <datasources>
    <datasource caption='Employee Hierarchy Self-Join' inline='true' name='employee_hierarchy' version='18.1'>
      <connection class='federated'>
        <named-connections>
          <named-connection caption='BigQuery' name='bigquery.hr_system'>
            <connection CATALOG='hr-analytics-project' EXECCATALOG='hr-database' authentication='oauth' class='bigquery' connection-dialect='google-sql' project='hr-analytics' schema='hr' server-oauth='' username='hr@company.com' />
          </named-connection>
        </named-connections>
        <relation type='collection'>
          <!-- Self-join: employee table joined to itself for manager relationships -->
          <relation join='left' type='join'>
            <clause type='join'>
              <expression op='='>
                <expression op='[employee].[manager_id]' />
                <expression op='[manager].[employee_id]' />
              </expression>
            </clause>
            <relation connection='bigquery.hr_system' name='employee' table='[hr-analytics-project.hr].[employees]' type='table' />
            <relation connection='bigquery.hr_system' name='manager' table='[hr-analytics-project.hr].[employees]' type='table' />
          </relation>
        </relation>
        <cols>
          <!-- Employee fields (primary instance) -->
          <map key='[employee_id]' value='[employee].[employee_id]' />
          <map key='[first_name]' value='[employee].[first_name]' />
          <map key='[last_name]' value='[employee].[last_name]' />
          <map key='[email]' value='[employee].[email]' />
          <map key='[hire_date]' value='[employee].[hire_date]' />
          <map key='[job_title]' value='[employee].[job_title]' />
          <map key='[department]' value='[employee].[department]' />
          <map key='[salary]' value='[employee].[salary]' />
          <map key='[manager_id]' value='[employee].[manager_id]' />
          <map key='[status]' value='[employee].[status]' />

          <!-- Manager fields (self-join instance) -->
          <map key='[employee_id (manager)]' value='[manager].[employee_id]' />
          <map key='[first_name (manager)]' value='[manager].[first_name]' />
          <map key='[last_name (manager)]' value='[manager].[last_name]' />
          <map key='[email (manager)]' value='[manager].[email]' />
          <map key='[job_title (manager)]' value='[manager].[job_title]' />
          <map key='[department (manager)]' value='[manager].[department]' />
          <map key='[salary (manager)]' value='[manager].[salary]' />
        </cols>
        <metadata-records>
          <!-- Employee table metadata -->
          <metadata-record class='column'>
            <remote-name>employee_id</remote-name>
            <remote-type>20</remote-type>
            <local-name>[employee_id]</local-name>
            <parent-name>[employee]</parent-name>
            <local-type>integer</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>first_name</remote-name>
            <remote-type>130</remote-type>
            <local-name>[first_name]</local-name>
            <parent-name>[employee]</parent-name>
            <local-type>string</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>last_name</remote-name>
            <remote-type>130</remote-type>
            <local-name>[last_name]</local-name>
            <parent-name>[employee]</parent-name>
            <local-type>string</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>manager_id</remote-name>
            <remote-type>20</remote-type>
            <local-name>[manager_id]</local-name>
            <parent-name>[employee]</parent-name>
            <local-type>integer</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>salary</remote-name>
            <remote-type>5</remote-type>
            <local-name>[salary]</local-name>
            <parent-name>[employee]</parent-name>
            <local-type>real</local-type>
          </metadata-record>

          <!-- Manager table metadata (self-join alias) -->
          <metadata-record class='column'>
            <remote-name>employee_id</remote-name>
            <remote-type>20</remote-type>
            <local-name>[employee_id (manager)]</local-name>
            <parent-name>[manager]</parent-name>
            <local-type>integer</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>first_name</remote-name>
            <remote-type>130</remote-type>
            <local-name>[first_name (manager)]</local-name>
            <parent-name>[manager]</parent-name>
            <local-type>string</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>last_name</remote-name>
            <remote-type>130</remote-type>
            <local-name>[last_name (manager)]</local-name>
            <parent-name>[manager]</parent-name>
            <local-type>string</local-type>
          </metadata-record>
          <metadata-record class='column'>
            <remote-name>salary</remote-name>
            <remote-type>5</remote-type>
            <local-name>[salary (manager)]</local-name>
            <parent-name>[manager]</parent-name>
            <local-type>real</local-type>
          </metadata-record>
        </metadata-records>
      </connection>
      <aliases enabled='yes' />
      <!-- Column definitions for dimensions and measures -->
      <column caption='Employee ID' datatype='integer' name='[employee_id]' role='dimension' type='ordinal' />
      <column caption='First Name' datatype='string' name='[first_name]' role='dimension' type='nominal' />
      <column caption='Last Name' datatype='string' name='[last_name]' role='dimension' type='nominal' />
      <column caption='Email' datatype='string' name='[email]' role='dimension' type='nominal' />
      <column caption='Job Title' datatype='string' name='[job_title]' role='dimension' type='nominal' />
      <column caption='Department' datatype='string' name='[department]' role='dimension' type='nominal' />
      <column caption='Status' datatype='string' name='[status]' role='dimension' type='nominal' />
      <column caption='Hire Date' datatype='date' name='[hire_date]' role='dimension' type='ordinal' />
      <column caption='Manager ID' datatype='integer' name='[manager_id]' role='dimension' type='ordinal' />

      <!-- Self-join manager dimensions -->
      <column caption='Manager First Name' datatype='string' name='[first_name (manager)]' role='dimension' type='nominal' />
      <column caption='Manager Last Name' datatype='string' name='[last_name (manager)]' role='dimension' type='nominal' />
      <column caption='Manager Job Title' datatype='string' name='[job_title (manager)]' role='dimension' type='nominal' />
      <column caption='Manager Department' datatype='string' name='[department (manager)]' role='dimension' type='nominal' />
      <column caption='Manager Email' datatype='string' name='[email (manager)]' role='dimension' type='nominal' />

      <!-- Measures -->
      <column caption='Salary' datatype='real' name='[salary]' role='measure' type='quantitative' />
      <column caption='Manager Salary' datatype='real' name='[salary (manager)]' role='measure' type='quantitative' />

      <layout dim-ordering='alphabetic' measure-ordering='alphabetic' show-structure='true' />
      <object-graph>
        <objects>
          <object caption='employee' id='employee_001'>
            <properties context=''>
              <relation connection='bigquery.hr_system' name='employee' table='[hr-analytics-project.hr].[employees]' type='table' />
            </properties>
          </object>
          <object caption='manager' id='manager_001'>
            <properties context=''>
              <relation connection='bigquery.hr_system' name='manager' table='[hr-analytics-project.hr].[employees]' type='table' />
            </properties>
          </object>
        </objects>
        <relationships>
          <!-- Self-join: Employee to Manager (same table, different aliases) -->
          <relationship>
            <expression op='='>
              <expression op='[manager_id]' />
              <expression op='[employee_id (manager)]' />
            </expression>
            <first-end-point object-id='employee_001' />
            <second-end-point object-id='manager_001' />
          </relationship>
        </relationships>
      </object-graph>
    </datasource>
  </datasources>
  <worksheets>
    <worksheet name='Employee Hierarchy'>
      <table>
        <view>
          <datasources>
            <datasource caption='Employee Hierarchy Self-Join' name='employee_hierarchy' />
          </datasources>
          <datasource-dependencies datasource='employee_hierarchy'>
            <!-- Dimensions from employee table -->
            <column caption='Employee ID' datatype='integer' name='[employee_id]' role='dimension' type='ordinal' />
            <column caption='First Name' datatype='string' name='[first_name]' role='dimension' type='nominal' />
            <column caption='Last Name' datatype='string' name='[last_name]' role='dimension' type='nominal' />
            <column caption='Email' datatype='string' name='[email]' role='dimension' type='nominal' />
            <column caption='Job Title' datatype='string' name='[job_title]' role='dimension' type='nominal' />
            <column caption='Department' datatype='string' name='[department]' role='dimension' type='nominal' />
            <column caption='Status' datatype='string' name='[status]' role='dimension' type='nominal' />
            <column caption='Hire Date' datatype='date' name='[hire_date]' role='dimension' type='ordinal' />
            <column caption='Manager ID' datatype='integer' name='[manager_id]' role='dimension' type='ordinal' />

            <!-- Dimensions from manager table (self-join) -->
            <column caption='Manager First Name' datatype='string' name='[first_name (manager)]' role='dimension' type='nominal' />
            <column caption='Manager Last Name' datatype='string' name='[last_name (manager)]' role='dimension' type='nominal' />
            <column caption='Manager Job Title' datatype='string' name='[job_title (manager)]' role='dimension' type='nominal' />
            <column caption='Manager Department' datatype='string' name='[department (manager)]' role='dimension' type='nominal' />
            <column caption='Manager Email' datatype='string' name='[email (manager)]' role='dimension' type='nominal' />

            <!-- Measures -->
            <column caption='Salary' datatype='real' name='[salary]' role='measure' type='quantitative' />
            <column caption='Manager Salary' datatype='real' name='[salary (manager)]' role='measure' type='quantitative' />

            <!-- Column instances for worksheet usage -->
            <column-instance column='[employee_id]' derivation='None' name='[none:employee_id:ok]' pivot='key' type='ordinal' />
            <column-instance column='[first_name]' derivation='None' name='[none:first_name:nk]' pivot='key' type='nominal' />
            <column-instance column='[job_title]' derivation='None' name='[none:job_title:nk]' pivot='key' type='nominal' />
            <column-instance column='[salary]' derivation='Sum' name='[sum:salary:qk]' pivot='key' type='quantitative' />
            <column-instance column='[first_name (manager)]' derivation='None' name='[none:first_name (manager):nk]' pivot='key' type='nominal' />
          </datasource-dependencies>
          <aggregation value='true' />
        </view>
        <style />
        <panes>
          <pane id='1' selection-relaxation-option='selection-relaxation-allow'>
            <view>
              <breakdown value='auto' />
            </view>
            <mark class='Automatic' />
          </pane>
        </panes>
        <rows>[employee_hierarchy].[none:employee_id:ok]</rows>
        <cols>[employee_hierarchy].[none:first_name:nk]</cols>
      </table>
      <simple-id uuid='{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}' />
    </worksheet>
  </worksheets>
</workbook>
